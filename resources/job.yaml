apiVersion: batch/v1
kind: Job
metadata:
  name: kubecom-load-fixtures
spec:
  template:
    spec:
      securityContext:
        fsGroup: 1000
        runAsUser: 1000
      containers:
        - name: kubecom
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
          image: "quay.io/django-hurricane/kubecom-demo:latest"
          imagePullPolicy: Always
          command: [ "/bin/sh","-c" ]
          args: [ "python manage.py loaddata apps/components/fixtures/components.json" ]
          env:
            - name: DATABASE_NAME
              value: django
            - name: DATABASE_HOST
              value: django-psql-cluster
            - name: DATABASE_USER
              valueFrom:
                secretKeyRef:
                  name: django.django-psql-cluster.credentials.postgresql.acid.zalan.do
                  key: username
            - name: DATABASE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: django.django-psql-cluster.credentials.postgresql.acid.zalan.do
                  key: password
          envFrom:
            - configMapRef:
                name: kubecom-configmap
      restartPolicy: OnFailure
  backoffLimit: 4